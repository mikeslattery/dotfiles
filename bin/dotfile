#!/bin/sh

# Moves a file in home to dotfiles.

# To do the reverse, run bootstrap.sh

set -eu

file="$1"
dotfiles="$HOME/src/dotfiles"

testordie() { test "$@" || { echo "ERROR: $*"; exit 1; }; }

testordie   -d "$dotfiles"

testordie ! -f "$dotfiles/$file"
testordie   -f "$HOME/$file"
testordie ! -L "$HOME/$file"
testordie ! -d "$HOME/$file"
testordie ! -f "$dotfiles/backup/$file"

mkdir -p "$(dirname "$dotfiles/$file")"

set -x

mv "$HOME/$file" "$dotfiles/$file"
ln -sfn "$dotfiles/$file" "$HOME/$file"
git -C "$dotfiles" add "$file"

